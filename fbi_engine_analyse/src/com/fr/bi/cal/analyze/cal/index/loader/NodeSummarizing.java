package com.fr.bi.cal.analyze.cal.index.loader;import com.fr.bi.stable.report.key.TargetGettingKey;import com.fr.bi.stable.report.result.BINode;/** * Created by Hiram on 2015/1/28. */public class NodeSummarizing {    private BINode node;    private TargetGettingKey[] targetGettingKeys;    public void setNode(BINode node) {        this.node = node;    }    public void setTargetGettingKeys(TargetGettingKey[] targetGettingKeys) {        this.targetGettingKeys = targetGettingKeys;    }    public BINode sum() {        sum(node);        return node;    }    private void sum(BINode node) {        if (node.getChildLength() == 0) {            return;        }        resetSummaryValue(node);        for (int i = 0; i < node.getChildLength(); i++) {            BINode child = node.getChild(i);            sum(child);            for (TargetGettingKey key : targetGettingKeys) {                Number value = node.getSummaryValue(key);                if (value == null) {                    node.setSummaryValue(key, child.getSummaryValue(key));                } else {                    Number childValue = child.getSummaryValue(key);                    if (childValue != null) {                        Double sum = value.doubleValue();                        sum += childValue.doubleValue();                        node.setSummaryValue(key, sum);                    }                }            }        }    }    private void resetSummaryValue(BINode node) {        for (TargetGettingKey key : targetGettingKeys) {            node.setSummaryValue(key, null);        }    }}