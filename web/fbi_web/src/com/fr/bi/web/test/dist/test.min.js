/*! test 12-07-2016 */
function environment(){function a(a,b){var c={};BI.each(a,function(a,b){BI.extend(c,b.dimensions)}),Data.SharingPool.put("dimensions",c),Data.SharingPool.put("widgets",a),null!=b&&Data.SharingPool.put("layoutType",b)}var b={1:{},2:{},3:{},4:{},5:{}},c={1:{type:BICst.WIDGET.AXIS,dimensions:b,view:{1e4:["1","2"],2e4:["3"],3e4:["4","5"]},bounds:{left:0,top:0,width:200,height:200}}};return a(c,BI.Arrangement.LAYOUT_TYPE.ADAPTIVE),{deleteDimensionById:function(d){delete b[d],BI.each(c,function(a,b){BI.each(b.view,function(a,b){b.contains(d)&&BI.remove(b,d)})}),a(c)},setWidgetTypeById:function(b,d){c[b].type=d,a(c)}}}describe("测试DimensionsManager",function(){it("维度的构建",function(){environment();var a={},b=BI.createWidget({type:"bi.dimensions_manager",element:$("#wrapper"),wId:"1",dimensionCreator:function(b,c){return a[b]||(a[b]=BI.createWidget()),a[b]}});b.populate();var c=b.getValue();$("#wrapper").empty(),expect(c.view).toEqual({1e4:["1","2"],2e4:["3"],3e4:["4","5"]})}),it("维度的删除",function(){var a=environment(),b={},c=BI.createWidget({type:"bi.dimensions_manager",element:$("#wrapper"),wId:"1",dimensionCreator:function(a,c){return b[a]||(b[a]=BI.createWidget()),b[a]}});c.populate();var d=c.getValue();expect(d.view).toEqual({1e4:["1","2"],2e4:["3"],3e4:["4","5"]}),a.deleteDimensionById("1"),c.populate();var d=c.getValue();expect(d.view).toEqual({1e4:["2"],2e4:["3"],3e4:["4","5"]})}),it("组件类型的切换",function(){var a=(environment(),{}),b=BI.createWidget({type:"bi.dimensions_manager",element:$("#wrapper"),wId:"1",dimensionCreator:function(b,c){return a[b]||(a[b]=BI.createWidget()),a[b]}});b.populate();var c=b.getValue();expect(c.view).toEqual({1e4:["1","2"],2e4:["3"],3e4:["4","5"]}),b.model.setType(BICst.WIDGET.TABLE);var c=b.getValue();expect(c.view).toEqual({1e4:["1","2","3"],3e4:["4","5"]})})}),describe("测试Fit",function(){it("自适应布局的构建",function(a){environment();var b={},c=BI.createWidget({type:"bi.fit",element:$("#wrapper"),layoutType:BI.Arrangement.LAYOUT_TYPE.ADAPTIVE,widgetCreator:function(a,c){return b[a]||(b[a]=BI.createWidget()),b[a]}});c.populate(),BI.nextTick(function(){var b=$("#wrapper").width(),d=$("#wrapper").height(),e=c.getAllRegions(),f=e[0],g={left:f.left,top:f.top,width:f.width,height:f.height};expect(g).toEqual({left:0,top:0,width:b-141,height:d}),$("#wrapper").empty(),a()})}),it("自适应布局的拷贝",function(a){environment();var b={},c=BI.createWidget({type:"bi.fit",element:$("#wrapper"),layoutType:BI.Arrangement.LAYOUT_TYPE.ADAPTIVE,widgetCreator:function(a,c){return b[a]||(b[a]=BI.createWidget()),b[a]}});c.populate(),BI.nextTick(function(){c.copyRegion("1");var b=c.getAllRegions();expect(b.length).toEqual(2),$("#wrapper").empty(),a()})}),it("自适应布局的删除",function(a){environment();var b={},c=BI.createWidget({type:"bi.fit",element:$("#wrapper"),layoutType:BI.Arrangement.LAYOUT_TYPE.ADAPTIVE,widgetCreator:function(a,c){return b[a]||(b[a]=BI.createWidget()),b[a]}});c.populate(),BI.nextTick(function(){c.deleteRegion("1");var b=c.getAllRegions();expect(b.length).toEqual(0),$("#wrapper").empty(),a()})})}),describe("测试BI.Utils方法",function(){it("getWidgetCalculationByID最简单的情况",function(){environment();var a=BI.Utils.getWidgetCalculationByID("1");expect(a.filter).toEqual({filter_type:80,filter_value:[]})})});