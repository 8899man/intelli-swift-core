package com.fr.bi.cluster;import com.finebi.cube.common.log.BILoggerFactory;import com.fr.base.FRContext;import com.fr.bi.cluster.manager.TextClusterHostManager;import com.fr.bi.cluster.manager.ZooKeeperClusterHostManager;import com.fr.bi.cluster.zookeeper.BIClusterMissionManager;import com.fr.bi.cluster.zookeeper.ZooKeeperException;import com.fr.bi.cluster.zookeeper.ZooKeeperManager;import com.fr.bi.cluster.zookeeper.ZooKeeperManagerInterface;/** * Created by Hiram on 2015/2/27. */public class ClusterManager implements BIClusterManagerInterface {    private static ClusterManager ourInstance = new ClusterManager();    private static ZooKeeperManagerInterface zooKeeperManager;    private static ClusterConfigManagerInterface clusterConfigManager;    private static ZooKeeperClusterHostManager zooKeeperClusterHostManager;    private static TextClusterHostManager textClusterHostManager;    private BIMissionManager missionManager;    public static final String MASTER_INFO = "masterInfo";    private ClusterManager() {    }    public static ClusterManager getInstance() {        ClusterAdapter.registerBIClusterManagerInterface(ourInstance);        return ourInstance;    }    @Override    public ZooKeeperManagerInterface getZooKeeperManager() {        return zooKeeperManager;    }    @Override    public BIMissionManager getMissionManager() {        return missionManager;    }    @Override    public ClusterConfigManagerInterface getClusterConfigManager() {        return clusterConfigManager;    }    @Override    public ClusterHostManagerInterface getHostManager() {        return zooKeeperClusterHostManager == null ? textClusterHostManager : zooKeeperClusterHostManager;    }    public void setZooKeeperClusterHostManager(ZooKeeperClusterHostManager zooKeeperClusterHostManager) {        this.zooKeeperClusterHostManager = zooKeeperClusterHostManager;    }    @Override    public void initClusterEnv() {        if (isClusterEnv()) {            try {                textClusterHostManager = TextClusterHostManager.getInstance();                zooKeeperManager = ZooKeeperManager.getInstance();                if (textClusterHostManager.isAutoVote()) {                    ((ZooKeeperManager) zooKeeperManager).addWatchers(MASTER_INFO, new BIMasterWatcher());                }                zooKeeperManager.startListen();                missionManager = new BIClusterMissionManager();            } catch (ZooKeeperException e) {                FRContext.getLogger().error("zookeeper can't com.fr.bi.test.connection!");                BILoggerFactory.getLogger().error(e.getMessage(), e);            }        }    }    @Override    public boolean isHost() {        return false;    }    private boolean isClusterEnv() {        return true;    }}